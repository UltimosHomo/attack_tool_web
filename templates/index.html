{% extends 'base.html' %}

{% block head %}
<title>Attack Tool</title>
{% endblock %}

{% block body %}

<h1>PLC attack tool</h1>
<h2>PLC Address</h2>
<input id="octet1" type="number" min="1" max="255" step="1" value="192" onchange="updateIp()"/>
<input id="octet2" type="number" min="1" max="255" step="1" value="168" onchange="updateIp()"/>
<input id="octet3" type="number" min="1" max="255" step="1" value="127" onchange="updateIp()"/>
<input id="octet4" type="number" min="1" max="255" step="1" value="1" onchange="updateIp()"/>
<h2>PLC Status</h2>
<div id="plcStatus"></div>
<h2>Modbus Attacks</h2>
<p>
    <form action="/attack/plc/modbus/disable" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisable" class="attackButton" type="submit">Disable control</button>
    </form>
    <form action="/attack/plc/modbus/disrupt" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisrupt" class="attackButton" type="submit">Disrupt operation</button>
    </form>
    <form action="/attack/plc/modbus/restore" method="post" onsubmit='disableButtons()'>
        <button name="modbusRestore" class="attackButton" type="submit">Restore control & operation</button>
    </form>
</p>
<h2>DoS Attacks</h2>
<p>
    <form action="/attack/plc/modbus/disable" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisable" class="attackButton" type="submit">Disable control</button>
    </form>
    <form action="/attack/plc/modbus/disrupt" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisrupt" class="attackButton" type="submit">Disrupt operation</button>
    </form>
</p>
<h2>Malware</h2>
<p>
    <form action="/attack/plc/modbus/disable" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisable" class="attackButton" type="submit">Disable control</button>
    </form>
    <form action="/attack/plc/modbus/disrupt" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisrupt" class="attackButton" type="submit">Disrupt operation</button>
    </form>
</p>
<h2>CVE Exploits</h2>
<p>
    <form action="/attack/plc/modbus/disable" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisable" class="attackButton" type="submit">Disable control</button>
    </form>
    <form action="/attack/plc/modbus/disrupt" method="post" onsubmit='disableButtons()'>
        <button name="modbusDisrupt" class="attackButton" type="submit">Disrupt operation</button>
    </form>
    <form action="/attack/plc/modbus/restore" method="post" onsubmit='disableButtons()'>
        <button name="modbusRestore" class="attackButton" type="submit">Restore control & operation</button>
    </form>
</p>
<h2>Log</h2>
<div id="log" style="height: 120px; overflow-y: scroll;"></div>
<script src="{{ url_for('static', filename='script/jquery-3.5.1.min.js') }}"></script>
<script type="text/javascript">
    function disableButtons() {
        var buttons = document.getElementsByClassName("attackButton");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].disabled = true;
            }
    }

    function updateIp() {
        var a = document.getElementById("octet1").value.toString();
        var b = document.getElementById("octet2").value.toString();
        var c = document.getElementById("octet3").value.toString();
        var d = document.getElementById("octet4").value.toString();
        var ip = a + "." + b + "." + c + "." + d
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "/update/plc_ip", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("ip=" + ip);
    }

    $(window).on('load',function(){
        refreshStatus();
        refreshLog();
        refreshIp()
    })
    function refreshStatus() {
        $.ajax({
            url: "/status/plc",
            type: "get",
            success: function(data) {
                $("#plcStatus").html(data);
            },
            complete: function() {
                setTimeout(refreshStatus, 1000);
            }
        });
    }

    function refreshLog() {
        $.ajax({
            url: "/status/log",
            type: "get",
            success: function(data) {
                $("#log").html(data);
            },
            complete: function() {
                setTimeout(refreshLog, 2000);
            }
        });
    }

    function refreshIp() {
        $.ajax({
            url: "/update/plc_ip",
            type: "get",
            success: function(data) {
                var arrayIp = data.split(".");
                $("#octet1").val(parseInt(arrayIp[0]));
                $("#octet2").val(parseInt(arrayIp[1]));
                $("#octet3").val(parseInt(arrayIp[2]));
                $("#octet4").val(parseInt(arrayIp[3]));
            },
        });
    }
</script>
{% endblock %}