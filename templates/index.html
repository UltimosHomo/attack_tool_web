{% extends 'base.html' %}

{% block head %}
<title>Attack Tool</title>
{% endblock %}

{% block body %}

<h1>PLC attack tool</h1>
<div class="accordion">
    <button id="button-plc-address" class="accordion-button">PLC address</button>
    <div class="accordion-content">
        <input id="octet1" type="number" min="1" max="255" step="1" onchange="updateIp()"/>
        <input id="octet2" type="number" min="1" max="255" step="1" onchange="updateIp()"/>
        <input id="octet3" type="number" min="1" max="255" step="1" onchange="updateIp()"/>
        <input id="octet4" type="number" min="1" max="255" step="1" onchange="updateIp()"/>
    </div>
</div>

<h2>PLC Status</h2>
<div id="plcStatus"></div>
<div class="accordion">
    <button id="button-modbus-attacks" class="accordion-button">Modbus Attacks</button>
    <div class="accordion-content">
        <ul>
            <li><button id="button-modbus-disable" class="attack-button" onclick="sendCommand('/attack/plc/modbus/disable')">Disable control</button></li>
            <li><button id="button-modbus-disrupt" class="attack-button" onclick="sendCommand('/attack/plc/modbus/disrupt')">Disrupt operation</button></li>
            <li><button id="button-modbus-restore" class="attack-button" onclick="sendCommand('/attack/plc/modbus/restore')">Restore control & operation</button></li>
        </ul>
    </div>
</div>

<div class="accordion">
    <button id="button-dos-attacks" class="accordion-button">DoS Attacks</button>
    <div class="accordion-content">
        <ul>
            <li><button name="dosTcpSyn" class="attack-button" onclick="sendCommand('/attack/dos/tcp-syn')">TCP Syn</button></li>
            <li><button name="dosTcpXmas" class="attack-button" onclick="sendCommand('/attack/dos/tcp-xmas')">TCP Xmas</button></li>
        </ul>
    </div>
</div>

<div class="accordion">
    <button id="button-malware" class="accordion-button">Malware</button>
    <div class="accordion-content">
        <ul>
            <li><button name="malwareEicar" class="attack-button" onclick="sendCommand('/attack/malware/eicar')">EICAR test</button></li>
            <li><button name="malwarePasswd" class="attack-button" onclick="sendCommand('/attack/malware/passwd')">Steal password</button></li>
        </ul>
    </div>
</div>

<div class="accordion">
    <button id="button-cve-exploits" class="accordion-button">CVE exploits</button>
    <div class="accordion-content">
        <ul>
            <li><button name="cve-2015-5374" class="attack-button" onclick="sendCommand('/attack/cve/2015-5374')">CVE-2015-5374</button></li>
            <li><button name="cve-2014-0750" class="attack-button" onclick="sendCommand('/attack/cve/2014-0750')">CVE-2014-0750</button></li>
        </ul>
    </div>
</div>

<h2>Log</h2>
<div id="log" style="height: 120px; overflow-y: scroll;"></div>
<script src="{{ url_for('static', filename='script/jquery-3.5.1.min.js') }}"></script>
<script type="text/javascript">
    $(window).on('load',function(){
        refreshStatus();
        refreshLog();
        refreshIp();
    })

    document.querySelectorAll('.accordion-button').forEach(button => {
        button.addEventListener('click', () => {
            button.classList.toggle('accordion-button--active');
        });
    });

    function disableButtons(status) {
        var buttons = document.getElementsByClassName("attack-button");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].disabled = status;
            }
    }

    function sendCommand(url) {
        disableButtons(true);
        $.ajax({
            url: url,
            type: "post",
            success: function(data) {
                if (data=="OK"){disableButtons(false);};
                refreshLog();
            }
        });
    }

    function updateIp() {
        var a = document.getElementById("octet1").value.toString();
        var b = document.getElementById("octet2").value.toString();
        var c = document.getElementById("octet3").value.toString();
        var d = document.getElementById("octet4").value.toString();
        var ip = a + "." + b + "." + c + "." + d
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "/update/plc_ip", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("ip=" + ip);
    }

    function refreshStatus() {
        $.ajax({
            url: "/status/plc",
            type: "get",
            success: function(data) {
                $("#plcStatus").html(data);
            },
            complete: function() {
                setTimeout(refreshStatus, 1000);
            }
        });
    }

    function refreshLog() {
        $.ajax({
            url: "/status/log",
            type: "get",
            success: function(data) {
                $("#log").html(data);
            }
        });
    }

    function refreshIp() {
        $.ajax({
            url: "/update/plc_ip",
            type: "get",
            success: function(data) {
                var arrayIp = data.split(".");
                $("#octet1").val(parseInt(arrayIp[0]));
                $("#octet2").val(parseInt(arrayIp[1]));
                $("#octet3").val(parseInt(arrayIp[2]));
                $("#octet4").val(parseInt(arrayIp[3]));
            },
        });
    }
</script>
{% endblock %}